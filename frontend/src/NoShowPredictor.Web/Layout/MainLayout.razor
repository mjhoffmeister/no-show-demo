@inherits LayoutComponentBase
@using NoShowPredictor.Web.Components
@inject IJSRuntime JS

<MudThemeProvider Theme="_theme" @bind-IsDarkMode="_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<CascadingValue Value="this">
    <MudLayout Class="chat-layout">
        @Body
    </MudLayout>
</CascadingValue>

@code {
    private bool _isDarkMode = false;
    private bool _initialized = false;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_initialized)
        {
            _initialized = true;
            // Detect system dark mode preference
            _isDarkMode = await JS.InvokeAsync<bool>("eval", "window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches");
            StateHasChanged();
        }
    }
    
    public void ToggleDarkMode()
    {
        _isDarkMode = !_isDarkMode;
        StateHasChanged();
    }
    
    public bool IsDarkMode => _isDarkMode;
    
    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#10a37f",
            Secondary = "#6e6e80",
            AppbarBackground = "#ffffff",
            Background = "#ffffff",
            Surface = "#f7f7f8",
            DrawerBackground = "#f7f7f8",
            Error = "#ef4444",
            Warning = "#f59e0b",
            Success = "#10b981",
            TextPrimary = "#0d0d0d",
            TextSecondary = "#6e6e80",
            ActionDefault = "#6e6e80",
            Divider = "#e5e5e5"
        },
        PaletteDark = new PaletteDark
        {
            Primary = "#10a37f",
            Secondary = "#8e8ea0",
            AppbarBackground = "#1a1a1a",
            Background = "#212121",
            Surface = "#2d2d2d",
            DrawerBackground = "#1a1a1a",
            Error = "#ef4444",
            Warning = "#f59e0b",
            Success = "#10b981",
            TextPrimary = "#ececf1",
            TextSecondary = "#8e8ea0",
            ActionDefault = "#8e8ea0",
            Divider = "#3d3d3d"
        },
        LayoutProperties = new LayoutProperties
        {
            DefaultBorderRadius = "12px"
        }
    };
}

<style>
    .chat-layout {
        height: 100vh;
        overflow: hidden;
    }
</style>
